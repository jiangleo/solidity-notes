# solidity-notes
Solidity 速查表

## 文件结构

### 版本注释

版本注释(Version Pragma)：标注 .sol 文件需要按照指定版本来进行编译，描述指定版本的规则和 npm 的一样。

```
pragma solidity ^0.4.19;
```

### 引入文件

引入文件(Importing other Source Files)：Solidity 引入文件的方式向后兼容 ES6 的 import 规则，在此基础上增加了一些语法。引入外部文件后可以使用外部文件的变量。

```
// ES6 引入外部文件。
import "filename";

// ES6 重命名外部文件的变量
import * as symbolName from "filename";

// Solidity 新增的重命名变量语法
import "filename" as symbolName;
```

### 注释

单行注释

```
// 这个是单行注释
```


多行注释

```
/*
这个是
多行注释
*/、
```


## 合同结构

在 Solidity 中的合同(Contracts)类似于面向对象语言中的类(Class)。每个合同中可以声明：状态变量(State Variables), 函数(Functions), 函数修饰符(Function Modifiers), 事件(Events), 结构类型(Struct Types) and 枚举类型(Enum Types).

### 状态变量

状态变量(State variable)：是永久存在链上的值。值有多种类型：包括值类型(Value Types)、引用类型(Reference Types)和映射(Mappings)等。

```
contract SimpleStorage {
    uint storedData; // 状态变量
}
```

### 函数

函数(Functions)：函数只能在类中进行声明，可以类比为 JavaScript 类的方法。

```
contract SimpleAuction {
    function bid() public payable { // Function
        // ...
    }
}
```

### 函数修饰符

函数修饰符(Function Modifiers)：一般用于执行该函数之前，判断函数是否符合执行条件。

```
contract Purchase {
    address public seller;

    modifier onlySeller() { // Modifier
        require(msg.sender == seller);
        _;
    }

    function abort() public onlySeller { // Modifier usage
        // ...
    }
}
```

### 事件

事件(Events)：事件可以“调用” JavaScript 中的回调函数。 

```
// Solidity
contract ClientReceipt {
    event Deposit(
        address indexed _from,
        bytes32 indexed _id,
        uint _value
    );

    function deposit(bytes32 _id) public payable {
        // 在 dapp 中 “触发” JavaScript 的回调函数
        emit Deposit(msg.sender, _id, msg.value);
    }
}
```

```
// JavaScript
var abi = /* abi as generated by the compiler */;
var ClientReceipt = web3.eth.contract(abi);
var clientReceipt = ClientReceipt.at("0x1234...ab67" /* address */);

// 在与 dapp 交互的接口中传入回调函数
var event = clientReceipt.Deposit(function(error, result) {
    if (!error)
        console.log(result);
});
```


### 结构类型

结构(Structs)：是一种自定义类型，可以将多个变量聚集起来。

```
contract Ballot {
    struct Voter { // Struct
        uint weight;
        bool voted;
        address delegate;
        uint vote;
    }
}
```

### 枚举类型

Enums(Structs)：是一种自定义类型，用于定义有限个值的集合。

```
contract Purchase {
    enum State { Created, Locked, Inactive } // Enum
}
```

## 类型

Solidity 提供几种基础数据类型(elementary types)。复合数据类型(complex types)由基础数据类型组成。

### 值类型

值类型(Value Types)：这些类型的变量将始终按值传递，也就是说它们在用作函数参数或赋值时总是被复制。

#### 布尔

布尔(bool)：`true` 、 `false`。

#### 整数

整数(Integers)：包括有符号(signed integers)和无符号整数(unsigned integers)。整数有从 `8` 到 `256` 的不同位数，`int` 指的的是 `int256`，`uint` 指的是 `uint256`。

```
contract SimpleStorage {
    uint storedData; // 声明 unit 类型的状态变量
}
```

#### 地址

地址(Address)：一个 20 字节的值，用于表示以太坊地址。

```
address x = 0xdCad3a6d3569DF655070DEd06cb7A1b2Ccd1D3AF
```

地址类型也有成员，如下：

- `<address>.balance`  (`uint256`): 地址余额，单位 Wei。
- `<address>.transfer(uint256 amount)`: 发送 amount 数量的以太坊(单位 Wei)给 address

### 引用类型 

在以太坊上复制的复杂数据类型需要的成本比基础数据类型的成本要高，操作复杂数据类型更要小心。因为复制数据类型的存储空间通常比值类型的要多，操作时需注意尽可能地传递引用，而不是复制整个值。


```
contract C {
    uint[] x; // the data location of x is storage

    // the data location of memoryArray is memory
    function f(uint[] memoryArray) public {
        x = memoryArray; // works, copies the whole array to storage
        var y = x; // works, assigns a pointer, data location of y is storage
        y[7]; // fine, returns the 8th element
        y.length = 2; // fine, modifies x through y
        delete x; // fine, clears the array, also modifies y
        // The following does not work; it would need to create a new temporary /
        // unnamed array in storage, but storage is "statically" allocated:
        // y = memoryArray;
        // This does not work either, since it would "reset" the pointer, but there
        // is no sensible location it could point to.
        // delete y;
        g(x); // calls g, handing over a reference to x
        h(x); // calls h and creates an independent, temporary copy in memory
    }

    function g(uint[] storage storageArray) internal {}
    function h(uint[] memoryArray) public {}
}
```


